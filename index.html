<!doctype html>
<html lang="ru">
<head>
	<title>Поиск на стене вконтакте</title>
    	<script src="http://vk.com/js/api/openapi.js" type="text/javascript"></script>
    	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<link rel="stylesheet" href="http://swey.biz/css/style.css"/>
	<link href="/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
    <script>
VK.init({
    apiId: 5322127
});
var id;
newUrl();
query();
function query() {
	VK.Api.call('wall.search', {owner_id: id, v: '5.27', count: 30}, function(r) {
		if(r.response) {
			$('#resultCount').html(r.response.count);
			if (r.response.count > 0)
			{
				$('#result').html('');
				for (var i=0; i<r.response.count; i++)
				{
					$('#result').append(''
								+ '<li class="c-list user' + r.response.items[i].id + ' pulse animated">'
									+ '<div class="contact-details">'
										+ '<div class="pull-left">'
											+ '<strong>' + r.response.items[i].text.substr(0,40) + '...</strong>'
											+ '<small><span class="glyphicon glyphicon-heart"></span> ' + r.response.items[i].likes.count + ' <span class="glyphicon glyphicon-bullhorn"></span> ' + r.response.items[i].reposts.count + ' <span class="glyphicon glyphicon-comment"></span> ' + r.response.items[i].comments.count + '</small>'
										+ '</div>'
										+ '<div class="pull-right">'
											+ '<a href="http://vk.com/wall' + id + '_' + r.response.items[i].id + '" class="btn btn-success btn-xs" target="_blank"><span class="glyphicon glyphicon-link"></span></a>'
										+ '</div>'
										+ '<div class="clearfix"></div>'
									+ '</div>'
								+ '</li>');
				}
			}
		}
	});
}
function newUrl() {
	var user_id = 57789423;
	if (user_id.indexOf("com/") >= 0)
		user_id = user_id.split('com/')[1];
	VK.Api.call('utils.resolveScreenName', {screen_name: user_id, v: '5.27'}, function(r) {
		if(r.response) {
			addGroup(user_id);
			}
		}
	});	
}
function addGroup(user_id) {
	$('#error').html('');
	VK.Api.call('groups.getById', {group_id: user_id, fields: 'photo_50', v: '5.27'}, function(r) {
			if(r.response) {
					id = '-' + r.response[0].id;
					$('#profiles').html(''
								+ '<li class="c-list user' + r.response[0].id + ' pulse animated">'
									+ '<div class="contact-pic">'
										+ '<a href="#"><img src="' + r.response[0].photo_50 + '" alt="" class="img-responsive"/></a>'
									+ '</div>'
									+ '<div class="contact-details">'
										+ '<div class="pull-left">'
											+ '<strong>' + r.response[0].name + '</strong>'
											+ '<small>CLUB' + r.response[0].id + '</small>'
										+ '</div>'
										+ '<div class="pull-right">'
											+ '<a href="http://vk.com/club' + r.response[0].id + '" class="btn btn-success btn-xs" target="_blank"><span class="glyphicon glyphicon-link"></span></a>'
										+ '</div>'
										+ '<div class="clearfix"></div>'
									+ '</div>'
								+ '</li>');
			}
	});
}
	</script>
    </body>
</html>
