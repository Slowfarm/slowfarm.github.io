<!doctype html>
<html lang="ru">
<head>
	<title>Поиск на стене вконтакте</title>
    <script src="http://vk.com/js/api/openapi.js" type="text/javascript"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<link rel="stylesheet" href="http://swey.biz/css/style.css"/>
	<link href="/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
	<section style="margin-top: 20px;">
		<div class="container">
			<div class="row">
				<div class="col-md-6">
					<div class="input-group">
					</div>
					<div id="error"></div>
					<div class="contacts-widget" style="margin-top: 20px;">
						<div class="widget-body 300-scroll">
							<ul class="list-unstyled">
								<li class="contact-alpha">
									Где будем искать?
									<div class="clearfix"></div>
								</li>
							</ul>
							<ul class="list-unstyled" id="profiles">
								<div class="errorL" id="errorL">Укажите профиль пользователя или сообщесва!</div>
							</ul>
						</div>
						<div class="widget-foot"></div>
					</div>
				</div>	
				<div class="col-md-6">
					<div class="input-group">
						<span class="input-group-btn">
							<button type="submit" class="btn btn-info" onclick="query(0);"><span class="glyphicon glyphicon-search"></span></button>
						</span>
					</div>
					<div class="contacts-widget" style="margin-top: 20px;">
						<div class="widget-body">
							<ul class="list-unstyled">
								<li class="contact-alpha">
									Найденные записи. <span class="label label-info pull-right"><span id="resultCount">0</span> Найденных записей</span>
									<div class="clearfix"></div>
								</li>
								<ul class="list-unstyled" id="result">
									
								</ul>
							</ul>
						</div>
						<div class="widget-foot"></div>
					</div>
				</div>		
			</div>
		</div>
	</section>
    <script>
VK.init({
    apiId: 5322127
});
var id;
newUrl();
function query(_offset) {
	VK.Api.call('wall.get', {owner_id: id, v: '5.27', count: 100, offset: _offset}, function(r) {
		if(r.response) {
			$('#resultCount').html(r.response.count);
				$('#result').html('');
				for (var i=0; i<r.response.count; i++)
				{
					$('#result').append(''
								+ '<li class="c-list user' + r.response.items[i].id + ' pulse animated">'
								+ '<div class="contact-details">'
								+ '<div class="pull-left">'
								+ r.response.items[i].text
								+  r.response.items[i].likes.count 
								+ r.response.items[i].reposts.count 
								+ r.response.items[i].comments.count
								+ '</div>'
								+ '<div class="pull-right">'
								+ '<a href="http://vk.com/wall' + id + '_' + r.response.items[i].id + '" class="btn btn-success btn-xs" target="_blank"><span class="glyphicon glyphicon-link"></span></a>'
								+ '</div>'
								+ '<div class="clearfix"></div>'
								+ '</div>'
								+ '</li>');
				}
		}
	});
}
function newUrl() {
	var user_id = "http://vk.com/miet.university";
	if (user_id.indexOf("com/") >= 0)
		user_id = user_id.split('com/')[1];
	VK.Api.call('utils.resolveScreenName', {screen_name: user_id, v: '5.27'}, function(r) {
		if(r.response) {
			addGroup(user_id);
		}
	});	
}
function addGroup(user_id) {
	$('#error').html('');
	VK.Api.call('groups.getById', {group_id: user_id, fields: 'photo_50', v: '5.27'}, function(r) {
			if(r.response) {
					id = '-' + r.response[0].id;
					$('#profiles').html(''
								+ '<li class="c-list user' + r.response[0].id + ' pulse animated">'
									+ '<div class="contact-pic">'
										+ '<a href="#"><img src="' + r.response[0].photo_50 + '" alt="" class="img-responsive"/></a>'
									+ '</div>'
									+ '<div class="contact-details">'
										+ '<div class="pull-left">'
											+ '<strong>' + r.response[0].name + '</strong>'
											+ '<small>CLUB' + r.response[0].id + '</small>'
										+ '</div>'
										+ '<div class="pull-right">'
											+ '<a href="http://vk.com/club' + r.response[0].id + '" class="btn btn-success btn-xs" target="_blank"><span class="glyphicon glyphicon-link"></span></a>'
										+ '</div>'
										+ '<div class="clearfix"></div>'
									+ '</div>'
								+ '</li>');
			}
	});
	for(var _offset = 1; _offset <=r.response[0].members_count; _offset+=100)
	query(_offset);
}
	</script>
    </body>
</html>
